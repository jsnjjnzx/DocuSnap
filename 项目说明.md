# DocuSnap 项目说明

## 📋 项目概述

**项目名称**: DocuSnap（注释快贴）  
**版本**: 1.0.0  
**类型**: VS Code 扩展  
**发布者**: jsnjjnzx  
**许可证**: MIT  

DocuSnap 是一款强大的 VS Code 扩展，让开发者能够在代码注释中轻松插入图片和文档链接，并支持悬浮预览。通过 `@link@` 标记，将代码注释与资源文件完美结合，提升代码可读性和文档化水平。

## 🎯 核心价值

- **提升代码可读性**: 通过图片和文档直观展示复杂逻辑
- **增强团队协作**: 统一的资源管理方式，便于团队共享
- **简化文档维护**: 资源文件与代码紧密关联，易于维护
- **提高开发效率**: 快速插入和预览，无需切换工具

## 📁 项目结构

```
DocuSnap/
├── .vscode/                    # VS Code 配置
├── images/                     # 扩展图标和演示
│   ├── icon.png               # 扩展图标
│   ├── demo.gif               # 功能演示
│   ├── links.svg              # 侧边栏图标
│   └── donate.png             # 捐赠图片
├── src/                        # 源代码
│   └── extension.ts           # 主扩展代码
├── out/                        # 编译输出（自动生成）
├── scripts/                    # 脚本工具
│   ├── package.bat            # Windows 打包脚本
│   ├── package.ps1            # PowerShell 打包脚本
│   ├── publish.bat            # Windows 发布脚本
│   ├── publish.ps1            # PowerShell 发布脚本
│   └── 使用说明.md            # 脚本使用说明
├── node_modules/               # 依赖包（自动生成）
├── package.json                # 扩展配置
├── package.nls.json            # 中文语言包
├── package.nls.en.json         # 英文语言包
├── tsconfig.json               # TypeScript 配置
├── README.md                   # 中文文档
├── README.en.md                # 英文文档
├── CHANGELOG.md                # 更新日志
├── LICENSE                     # 许可证
├── 快速开始.md                 # 快速入门指南
├── 项目说明.md                 # 本文件
└── .gitignore                  # Git 忽略配置
```

## 🚀 开发环境

### 系统要求

- **Node.js**: >= 14.x
- **npm**: >= 6.x
- **VS Code**: >= 1.84.0
- **TypeScript**: ^5.5.4

### 依赖包

#### 开发依赖
- `@types/vscode`: VS Code API 类型定义
- `@types/node`: Node.js 类型定义
- `typescript`: TypeScript 编译器
- `vsce`: VS Code 扩展打包工具

#### 可选依赖
- `ffmpeg-static`: 视频处理（用于生成演示 GIF）
- `fluent-ffmpeg`: FFmpeg 封装库

## 🛠️ 开发指南

### 环境搭建

1. **克隆仓库**
   ```bash
   git clone https://github.com/jsnjjnzx/DocuSnap.git
   cd DocuSnap
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **编译代码**
   ```bash
   npm run compile
   ```

4. **调试运行**
   - 在 VS Code 中打开项目
   - 按 `F5` 启动调试
   - 会打开一个新的 VS Code 窗口（扩展开发主机）
   - 在新窗口中测试扩展功能

### 开发命令

```bash
# 编译 TypeScript
npm run compile

# 监听模式编译（自动重新编译）
npm run watch

# 打包扩展
npm run package

# 发布扩展
npm run publish

# 生成演示 GIF（需要 demo.mp4）
npm run gif
```

### 代码结构

#### extension.ts 主要模块

1. **资源管理**
   - `getAssetsDir()`: 获取资源目录
   - `copyIntoAssets()`: 复制文件到资源目录
   - `ensureDir()`: 确保目录存在

2. **注释规则**
   - `getLineCommentToken()`: 获取当前语言的注释符
   - `parseCommentTokenRules()`: 解析注释规则配置
   - `getEffectiveCommentMap()`: 获取有效的注释映射

3. **命令处理**
   - `handleInsertImage()`: 插入图片
   - `handleInsertDoc()`: 插入文档
   - `handleSmartPaste()`: 智能粘贴
   - `handleInsertImageFromClipboard()`: 从剪贴板插入

4. **悬浮预览**
   - `AssetHoverProvider`: 悬浮提示提供者
   - `PinnedPreviewViewProvider`: 固定预览视图提供者

5. **链接管理**
   - `LinksTreeDataProvider`: 链接树视图提供者
   - 扫描、检测、清理链接功能

6. **平台兼容**
   - Windows 原生支持
   - WSL 环境支持
   - 跨平台路径处理

## 📦 打包与发布

### 打包流程

使用提供的脚本进行打包：

**Windows 批处理**:
```cmd
cd scripts
package.bat
```

**PowerShell**:
```powershell
cd scripts
.\package.ps1
```

**手动打包**:
```bash
npm run compile
npm run package
```

生成的 `.vsix` 文件可用于本地安装或分发。

### 发布流程

详细步骤请参考 [scripts/使用说明.md](scripts/使用说明.md)

**简要步骤**:

1. **准备工作**
   - 创建 Azure DevOps 账号
   - 创建发布者账号（jsnjjnzx）
   - 生成 Personal Access Token (PAT)
   - 登录：`vsce login jsnjjnzx`

2. **更新版本**
   - 修改 `package.json` 中的 `version`
   - 更新 `CHANGELOG.md`
   - 测试所有功能

3. **执行发布**
   ```cmd
   cd scripts
   publish.bat
   ```
   或
   ```powershell
   cd scripts
   .\publish.ps1
   ```

4. **验证发布**
   - 访问市场页面确认
   - 等待审核通过（几分钟到几小时）

## 🧪 测试指南

### 功能测试清单

- [ ] **插入图片**
  - [ ] 单个图片插入
  - [ ] 多个图片批量插入
  - [ ] 文件名冲突处理
  - [ ] 不同图片格式（PNG, JPG, GIF, SVG, WebP）

- [ ] **插入文档**
  - [ ] Markdown 文件
  - [ ] 文本文件
  - [ ] PDF 文件

- [ ] **剪贴板功能**
  - [ ] 截图粘贴
  - [ ] 文件复制粘贴
  - [ ] 路径文本粘贴
  - [ ] 普通文本粘贴（不干扰）

- [ ] **悬浮预览**
  - [ ] 图片预览
  - [ ] Markdown 预览
  - [ ] 文本预览
  - [ ] 固定预览功能

- [ ] **链接管理**
  - [ ] 链接列表显示
  - [ ] 跳转到代码位置
  - [ ] 无效链接检测
  - [ ] 批量清理功能
  - [ ] 搜索过滤功能

- [ ] **配置选项**
  - [ ] 自定义资源目录
  - [ ] 注释规则配置
  - [ ] 智能粘贴覆盖
  - [ ] 详细日志输出

- [ ] **跨平台**
  - [ ] Windows 环境
  - [ ] WSL 环境
  - [ ] 路径处理正确性

### 测试环境

建议在以下环境中测试：
- Windows 10/11
- WSL2 (Ubuntu)
- 不同编程语言文件（JS, TS, Python, C++, etc.）
- 不同工作区配置

## 📊 版本管理

### 版本号规范

遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：

- **主版本号 (Major)**: 不兼容的 API 修改
- **次版本号 (Minor)**: 向下兼容的功能性新增
- **修订号 (Patch)**: 向下兼容的问题修正

### 版本历史

- **1.0.0** (2025-12-28): 首次发布
  - 完整的资源插入功能
  - 悬浮预览和固定预览
  - 链接管理视图
  - 智能粘贴功能
  - 中英文双语支持

## 🤝 贡献指南

欢迎贡献代码、报告问题或提出建议！

### 贡献流程

1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

### 代码规范

- 使用 TypeScript
- 遵循现有代码风格
- 添加必要的注释
- 确保编译无错误
- 测试新功能

### 提交规范

使用约定式提交（Conventional Commits）：

- `feat:` 新功能
- `fix:` 修复问题
- `docs:` 文档更新
- `style:` 代码格式调整
- `refactor:` 代码重构
- `test:` 测试相关
- `chore:` 构建/工具相关

## 📝 文档资源

### 用户文档
- [README.md](README.md) - 中文完整文档
- [README.en.md](README.en.md) - 英文完整文档
- [快速开始.md](快速开始.md) - 快速入门指南
- [CHANGELOG.md](CHANGELOG.md) - 更新日志

### 开发文档
- [scripts/使用说明.md](scripts/使用说明.md) - 打包发布指南
- [项目说明.md](项目说明.md) - 本文件

### 外部资源
- [VS Code 扩展 API](https://code.visualstudio.com/api)
- [VS Code 扩展发布指南](https://code.visualstudio.com/api/working-with-extensions/publishing-extension)
- [TypeScript 文档](https://www.typescriptlang.org/docs/)

## 🔗 相关链接

- **GitHub 仓库**: https://github.com/jsnjjnzx/DocuSnap
- **市场页面**: https://marketplace.visualstudio.com/items?itemName=jsnjjnzx.docusnap-assets
- **问题反馈**: https://github.com/jsnjjnzx/DocuSnap/issues
- **更新日志**: https://github.com/jsnjjnzx/DocuSnap/blob/main/CHANGELOG.md

## 📄 许可证

本项目采用 MIT 许可证。详见 [LICENSE](LICENSE) 文件。

## 👥 作者

- **jsnjjnzx** - 初始工作 - [GitHub](https://github.com/jsnjjnzx)

## 🙏 致谢

感谢所有使用和支持 DocuSnap 的开发者！

如果这个项目对你有帮助，欢迎：
- ⭐ 在 GitHub 上给项目加星
- 📝 在市场上留下评价
- 🐛 报告问题和建议
- 💡 分享给更多开发者

---

**最后更新**: 2025-12-28  
**文档版本**: 1.0.0
