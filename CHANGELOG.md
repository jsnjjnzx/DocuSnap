# 更新日志 · [English](CHANGELOG.en.md)

## [0.3.0] - 2025-12-28
### 新增
- **WSL 支持**：完整支持在 WSL 环境下使用插件
  - 自动检测 WSL 环境
  - 使用 `powershell.exe` 访问 Windows 剪贴板
  - 自动转换 Windows 路径和 WSL 路径（`C:\path` ↔ `/mnt/c/path`）
  - 剪贴板图片导出、文件列表读取、智能粘贴等功能在 WSL 中正常工作

- **自动化测试框架**：建立完整的测试体系
  - 单元测试：18 个测试覆盖路径处理、WSL 检测、注释规则解析等核心功能
  - 集成测试：10 个测试覆盖扩展激活、命令注册、悬浮预览、链接扫描等功能
  - 测试工具：快速测试脚本、VSCode 调试配置、GitHub Actions CI/CD
  - 测试文档：详细的测试指南和使用说明

### 改进
- **路径处理增强**：新增 `wslPathToWin()` 函数，支持 WSL 路径转 Windows 路径
- **剪贴板功能优化**：统一的 `canUseWindowsClipboard()` 检测，支持原生 Windows 和 WSL
- **PowerShell 调用优化**：根据环境自动选择 `powershell` 或 `powershell.exe`

### 开发体验
- 新增测试命令：`npm run test:unit`（单元测试）、`npm test`（集成测试）
- 新增快速测试脚本：`node test/runQuickTest.js [unit|integration|all]`
- 新增 VSCode 调试配置：可在 IDE 中直接调试测试
- 新增 GitHub Actions 工作流：自动在多平台（Ubuntu、Windows、macOS）运行测试

### 文档
- 新增 `test/README.md`：测试目录说明
- 新增 `测试指南.md`：详细的测试使用指南
- 新增 `测试实现总结.md`：测试实现和覆盖率总结

### 技术债务
- 更新 TypeScript 配置：支持测试文件编译
- 添加测试依赖：Mocha、Chai、@vscode/test-electron 等
- 修复 package.json 中的激活事件警告

## [0.2.5] - 2025-10-08
### 性能
- 覆盖 Ctrl+V 的“智能粘贴”明显提速：
	- 为“纯文本”粘贴增加快速通道，跳过外部探测；
	- 对剪贴板图片/文件的外部探测增加约 150ms 超时，避免阻塞编辑；
	- 弹窗改为非模态，减少交互卡顿。

### 行为
- 更严格的“文本路径”判定：仅当路径存在且为受支持的文件类型（png/jpg/jpeg/gif/svg/webp/md/txt/pdf）时，才视作文件；避免把目录或不相关文本误判为文件。

### CI
- 发布工作流调整为仅手动触发（workflow_dispatch），避免日常 push 触发邮件提醒；如需发布，请在 Actions 中手动 Run。

## [0.2.4] - 2025-09-16
### 变更
- 细节优化

## [0.2.3] - 2025-09-15
### 变更
- 迁移为“规则唯一来源”：移除 `docuSnap.commentTokenMap`，仅使用 `docuSnap.commentTokenRules` 解析扩展名→注释符。
- 默认内置常见语言的规则组，开箱即用。
- 删除命令更新：`docusnap.deleteCommentTokens` 现用于从规则中移除所选扩展名（按行重写规则，空行自动去除）。

### 体验
- 当当前文件扩展名未命中任何规则时，插入将阻断并弹窗提示，支持一键打开设置配置 `docuSnap.commentTokenRules`。

## [0.2.2] - 2025-09-15
### 新增
- 新增设置 `docuSnap.verboseLog`：可开启“详细日志”，输出候选样本、逐文件扫描、删除明细等调试信息。

### 优化
- 默认日志更安静：仅保留开始/结束与关键计数；清理流程不再强制打开日志面板。
- 将大量调试打印统一纳入“详细日志”开关；诊断命令的候选样本亦仅在详细模式下输出。
- 启动签名日志仅在详细模式下打印。

## [0.2.1] - 2025-09-15
### 新增
- 智能粘贴弹窗新增“重命名插入”按钮：
	- 直接一步选择是否进入重命名流程，减少二次弹窗打扰；
	- 支持为剪贴板图片/文件在写入 assets 前改名（校验非法字符，自动避免重名冲突）。

### 优化
- 侧边栏 Links 视图“…”菜单项文案优化：由“清理当前文件的无效链接”改为“清理无效链接”，更简洁。

## [0.2.0] - 2025-09-14
### 新增
- Links 侧边视图（Activity Bar）：按文件分组列出所有 `@link@`，支持：
	- 点击跳转到源码位置；
	- 右上角“…”溢出菜单：刷新、切换“只显示无效链接”、清理当前文件的无效链接；
	- 单个链接右键“删除此链接”；
	- 自动刷新：监听文档与资产目录变更，含轻微去抖。
- 本地化与图标：
	- Activity Bar 容器标题与视图名使用 NLS（中文环境显示“注释快贴”与“链接”）；
	- 新增 `images/links.svg` 作为侧边栏图标。

### 改进
- `@link@` 解析与坏链检测更健壮、更高效：
	- 正则支持半角/全角冒号与引号包裹路径；
	- 工作区扫描合并“已打开但未保存”的内存文本；
	- 文件存在性检查在“文件范围”使用 fs.stat，在“工作区范围”优先命中资产集合，未命中时回退 fs.stat；
	- 并发受控的扫描与存在性检查；
	-（已提供）可配置的包含/排除 globs 控制扫描范围。
- 视图操作更贴近原生样式：仅保留在视图“…”溢出菜单中，减少标题栏按钮干扰。

### 修复
- 当被引用的资产文件被删除时，坏链接能稳定识别并清理。

## [0.1.3] - 2025-09-14
- 修复：当在资产目录中删除被引用的文件后，执行“清理无效链接”无法检测到坏链接的问题。
	- 现在在计算坏链接时，会对每个 `@link@` 进行即时文件存在性检查（fs.stat），确保删除的文件能被正确识别；
	- 在工作区范围下仍保留原有资产集合以优化性能，未命中集合时回退到文件系统检查，性能与准确性兼顾。
### 文档
- 丰富 README：新增快速预览动图、示例与建议，完善英文版 README

## [0.1.2] - 2025-09-14
### 变更
- 更新扩展图标（更清晰的视觉表现与在深浅主题下的对比度）

## [0.1.1] - 2025-09-14
### 优化
- 提升“清理无效链接”在大型项目下的扫描与处理性能（新增包含/排除 globs、并发解析与进度提示）

## [0.1.0] - 2025-09-14
### 新增
- 首次在 VS Code 市场发布

