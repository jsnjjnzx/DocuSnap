# DocuSnap è‡ªåŠ¨åŒ–æµ‹è¯•

æœ¬ç›®å½•åŒ…å« DocuSnap æ‰©å±•çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶ã€‚

## æµ‹è¯•ç±»å‹

### 1. é›†æˆæµ‹è¯•ï¼ˆIntegration Testsï¼‰
ä½äº `test/suite/` ç›®å½•ï¼Œéœ€è¦åœ¨çœŸå®çš„ VSCode ç¯å¢ƒä¸­è¿è¡Œã€‚

**æµ‹è¯•å†…å®¹ï¼š**
- `extension.test.ts` - æ‰©å±•æ¿€æ´»ã€å‘½ä»¤æ³¨å†Œã€é…ç½®é¡¹æµ‹è¯•
- `hover.test.ts` - æ‚¬æµ®é¢„è§ˆåŠŸèƒ½æµ‹è¯•
- `linkScanning.test.ts` - é“¾æ¥æ‰«æåŠŸèƒ½æµ‹è¯•

### 2. å•å…ƒæµ‹è¯•ï¼ˆUnit Testsï¼‰
ä½äº `test/unit/` ç›®å½•ï¼Œç‹¬ç«‹è¿è¡Œï¼Œä¸éœ€è¦ VSCode ç¯å¢ƒã€‚

**æµ‹è¯•å†…å®¹ï¼š**
- `pathUtils.test.ts` - è·¯å¾„å¤„ç†å·¥å…·å‡½æ•°æµ‹è¯•
  - è·¯å¾„è§„èŒƒåŒ–
  - WSL æ£€æµ‹
  - Windows/WSL è·¯å¾„è½¬æ¢
  - æ³¨é‡Šè§„åˆ™è§£æ

## è¿è¡Œæµ‹è¯•

### å®‰è£…ä¾èµ–
```bash
npm install
```

### è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
```bash
npm test
```

è¿™ä¼šï¼š
1. ç¼–è¯‘ TypeScript ä»£ç 
2. ä¸‹è½½å¹¶å¯åŠ¨ VSCode æµ‹è¯•å®ä¾‹
3. è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
4. æ˜¾ç¤ºæµ‹è¯•ç»“æœ

### è¿è¡Œå•å…ƒæµ‹è¯•
```bash
npm run test:unit
```

å•å…ƒæµ‹è¯•è¿è¡Œé€Ÿåº¦å¿«ï¼Œä¸éœ€è¦å¯åŠ¨ VSCodeã€‚

### å¼€å‘æ¨¡å¼
åœ¨å¼€å‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ watch æ¨¡å¼è‡ªåŠ¨ç¼–è¯‘ï¼š
```bash
npm run watch
```

ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•ã€‚

## æµ‹è¯•è¦†ç›–èŒƒå›´

### âœ… å·²è¦†ç›–åŠŸèƒ½
- [x] æ‰©å±•æ¿€æ´»
- [x] å‘½ä»¤æ³¨å†Œ
- [x] é…ç½®é¡¹éªŒè¯
- [x] æ‚¬æµ®é¢„è§ˆ
- [x] é“¾æ¥æ‰«æ
- [x] è·¯å¾„å¤„ç†å·¥å…·
- [x] WSL è·¯å¾„è½¬æ¢
- [x] æ³¨é‡Šè§„åˆ™è§£æ

### ğŸš§ å¾…æ·»åŠ æµ‹è¯•
- [ ] å‰ªè´´æ¿åŠŸèƒ½ï¼ˆéœ€è¦æ¨¡æ‹Ÿï¼‰
- [ ] æ™ºèƒ½ç²˜è´´
- [ ] æ¸…ç†æ— æ•ˆé“¾æ¥
- [ ] ä¾§è¾¹æ è§†å›¾
- [ ] WebView é¢„è§ˆ
- [ ] æ–‡ä»¶æ“ä½œï¼ˆå¤åˆ¶ã€åˆ é™¤ï¼‰

## ç¼–å†™æ–°æµ‹è¯•

### é›†æˆæµ‹è¯•ç¤ºä¾‹
```typescript
import * as assert from 'assert';
import * as vscode from 'vscode';

suite('æˆ‘çš„æµ‹è¯•å¥—ä»¶', () => {
  test('æµ‹è¯•ç”¨ä¾‹åç§°', async () => {
    // å‡†å¤‡æµ‹è¯•æ•°æ®
    const doc = await vscode.workspace.openTextDocument({
      content: '// @link@:images/test.png',
      language: 'javascript'
    });
    
    // æ‰§è¡Œæ“ä½œ
    const result = await vscode.commands.executeCommand('docusnap.someCommand');
    
    // æ–­è¨€ç»“æœ
    assert.ok(result, 'åº”è¯¥è¿”å›ç»“æœ');
  });
});
```

### å•å…ƒæµ‹è¯•ç¤ºä¾‹
```typescript
import { expect } from 'chai';

describe('å·¥å…·å‡½æ•°', () => {
  it('åº”è¯¥æ­£ç¡®å¤„ç†è¾“å…¥', () => {
    const result = myFunction('input');
    expect(result).to.equal('expected');
  });
});
```

## è°ƒè¯•æµ‹è¯•

### VSCode è°ƒè¯•é…ç½®
åœ¨ `.vscode/launch.json` ä¸­æ·»åŠ ï¼š
```json
{
  "name": "æ‰©å±•æµ‹è¯•",
  "type": "extensionHost",
  "request": "launch",
  "args": [
    "--extensionDevelopmentPath=${workspaceFolder}",
    "--extensionTestsPath=${workspaceFolder}/out/test/suite/index"
  ],
  "outFiles": ["${workspaceFolder}/out/test/**/*.js"]
}
```

ç„¶åæŒ‰ F5 å¯åŠ¨è°ƒè¯•ã€‚

## æŒç»­é›†æˆ

å¯ä»¥åœ¨ GitHub Actions ä¸­è¿è¡Œæµ‹è¯•ï¼š

```yaml
name: æµ‹è¯•

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm install
      - run: xvfb-run -a npm test
```

## æ³¨æ„äº‹é¡¹

1. **é›†æˆæµ‹è¯•éœ€è¦å›¾å½¢ç•Œé¢**ï¼šåœ¨ Linux CI ç¯å¢ƒä¸­éœ€è¦ä½¿ç”¨ `xvfb-run`
2. **æµ‹è¯•éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹ï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„çŠ¶æ€
3. **æ¸…ç†èµ„æº**ï¼šä½¿ç”¨ `suiteTeardown` æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œèµ„æº
4. **è¶…æ—¶è®¾ç½®**ï¼šæŸäº›æµ‹è¯•å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ï¼Œå¯ä»¥è°ƒæ•´ timeout
5. **WSL æµ‹è¯•**ï¼šå‰ªè´´æ¿ç›¸å…³æµ‹è¯•åœ¨ WSL ä¸­éœ€è¦ç‰¹æ®Šå¤„ç†

## æ•…éšœæ’æŸ¥

### æµ‹è¯•å¤±è´¥
- æ£€æŸ¥ VSCode ç‰ˆæœ¬æ˜¯å¦å…¼å®¹
- ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- æŸ¥çœ‹æµ‹è¯•è¾“å‡ºçš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### æµ‹è¯•è¶…æ—¶
- å¢åŠ  Mocha çš„ timeout è®¾ç½®
- æ£€æŸ¥æ˜¯å¦æœ‰å¼‚æ­¥æ“ä½œæœªæ­£ç¡®ç­‰å¾…

### æ‰¾ä¸åˆ°å‘½ä»¤
- ç¡®ä¿æ‰©å±•å·²æ­£ç¡®æ¿€æ´»
- æ£€æŸ¥å‘½ä»¤ ID æ˜¯å¦æ­£ç¡®æ³¨å†Œ

## è´¡çŒ®æŒ‡å—

æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œè¯·åŒæ—¶æ·»åŠ ç›¸åº”çš„æµ‹è¯•ï¼š
1. å•å…ƒæµ‹è¯•ï¼šæµ‹è¯•çº¯å‡½æ•°å’Œå·¥å…·æ–¹æ³•
2. é›†æˆæµ‹è¯•ï¼šæµ‹è¯•ä¸ VSCode API çš„äº¤äº’
3. ç¡®ä¿æµ‹è¯•é€šè¿‡åå†æäº¤ä»£ç 
